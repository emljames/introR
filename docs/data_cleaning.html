<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data cleaning in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-991b1886d3c685c7aa2b62b80640c7af.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Introduction to R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./setup.html"> 
<span class="menu-text">Set up</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./navigating_R.html"> 
<span class="menu-text">Navigating R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./data_cleaning.html" aria-current="page"> 
<span class="menu-text">Cleaning data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data_transformation.html"> 
<span class="menu-text">Transforming data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./reproducibility.html"> 
<span class="menu-text">Reproducibility</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#setting-up" id="toc-setting-up" class="nav-link active" data-scroll-target="#setting-up"><span class="header-section-number">1</span> Setting up</a>
  <ul class="collapse">
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages"><span class="header-section-number">1.1</span> Load packages</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data"><span class="header-section-number">1.2</span> Load data</a></li>
  <li><a href="#data-dictionary" id="toc-data-dictionary" class="nav-link" data-scroll-target="#data-dictionary"><span class="header-section-number">1.3</span> Data dictionary</a></li>
  </ul></li>
  <li><a href="#select-relevant-variables" id="toc-select-relevant-variables" class="nav-link" data-scroll-target="#select-relevant-variables"><span class="header-section-number">2</span> <code>select()</code> relevant variables</a></li>
  <li><a href="#rename-variables" id="toc-rename-variables" class="nav-link" data-scroll-target="#rename-variables"><span class="header-section-number">3</span> <code>rename() variables</code></a></li>
  <li><a href="#filter-for-relevant-data" id="toc-filter-for-relevant-data" class="nav-link" data-scroll-target="#filter-for-relevant-data"><span class="header-section-number">4</span> <code>filter()</code> for relevant data</a></li>
  <li><a href="#combining-data-cleaning-steps-using-the-pipe-operator" id="toc-combining-data-cleaning-steps-using-the-pipe-operator" class="nav-link" data-scroll-target="#combining-data-cleaning-steps-using-the-pipe-operator"><span class="header-section-number">5</span> Combining data cleaning steps using the pipe <code>|&gt;</code> operator</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data cleaning in R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this section of the workshop, we will learn how to manipulate your data in R. Being able to process and reformat your data in a fast and reproducible way is a major benefit of working in R relative to e.g., Excel and SPSS. We will use a set of functions dedicated to this purpose, known as the <em>tidyverse</em>. In this section, we will refine our dataset based on the variables and observations that we actually need.</p>
<section id="setting-up" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Setting up</h1>
<section id="load-packages" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="load-packages"><span class="header-section-number">1.1</span> Load packages</h2>
<p><em>(If you’re following this material directly after the <a href="https://emljames.github.io/introR/navigating_R.html">Navigating R</a> content, then you’ve already done this first step!)</em></p>
<p>We need to load a collection of functions from the <em>tidyverse</em>. If you have not already installed this package, you still need to run <code>install.packages("tidyverse")</code> in the Console first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="load-data"><span class="header-section-number">1.2</span> Load data</h2>
<p>We will be working with data collected from a study of sleep and word learning in children (<a href="https://acamh.onlinelibrary.wiley.com/doi/full/10.1111/jcpp.13253">James, Gaskell, &amp; Henderson, 2020</a>). The experiment involved teaching children the names of unusual plants/animals, and testing their memory for them after periods of wake and sleep. For this lesson, we will analyse the data from the picture naming task, in which children were asked to name pictures of the items as quickly as they could. We will focus on data from the first two test sessions only (12-hour period containing wake or sleep).</p>
<p>The folder circulated included folder with the data in it, so we need to instruct R to navigate to the correct file within the raw data folder. If you look in the files pane, you should see that we are currently located in the scripts folder. To navigate to the data folder, we need to include “../” in the file path to instruct R to go “up one level”, then “data/” to go into the data folder, “raw/” to go into the raw data folder, then the file name (including path extension).</p>
<p>Let’s read in the picture naming file, and assign it to the object “raw_dat”. Remember, the <code>&lt;-</code> means that the action to the right is assigned to the “object” name on the left.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>raw_dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/raw/picName_raw.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should now see an object named <code>raw_dat</code> in the environment pane, on the top right of your RStudio window. You can see that it has 6602 observations (rows) for 9 variables (columns). You can inspect this by click on the little grid icon next to it.</p>
<p>We can also inspect the data format by calling <code>summary()</code> to preview the data, and using the <code>head()</code> function to print the first few rows. Run these lines of code and inspect the output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary of variables</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(raw_dat)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print first rows of dataset </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(raw_dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You don’t need to worry too much about what these different variables mean for the purposes of this workshop, but you can see here that this is trial level data. The dependent variables are accuracy and RT, and we have these across several items for each participant. A full data dictionary is described below.</p>
</section>
<section id="data-dictionary" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="data-dictionary"><span class="header-section-number">1.3</span> Data dictionary</h2>
<ul>
<li><strong>ID</strong> — a unique anonymised code for each participant</li>
<li><strong>group</strong> — whether participants were good comprehenders (GC) or poor comprehenders (PC)</li>
<li><strong>task</strong> — which task this data comes from (all PNN)</li>
<li><strong>week</strong> — whether participants completed this learnTime condition in the first or second week (counterbalanced)</li>
<li><strong>learnTime</strong> — whether participants learned the items in the morning (AM) or evening (PM). This was a repeated measures manipulation—all participants completed both a morning and evening condition to compare sleep and wake effects on memory.</li>
<li><strong>time</strong> — whether the data are from test 1 (immediately after learning), test 2 (12 hours later), test 3 (24 hours later), or test 4 (one month later)</li>
<li><strong>item</strong> — the word trained and tested</li>
<li><strong>acc</strong> — whether the participant successfully recalled the word in the picture naming task</li>
<li><strong>RT</strong> — response time (ms), for accurate responses only</li>
</ul>
<p>We don’t necessarily need everything here, so let’s start wrangling!</p>
</section>
</section>
<section id="select-relevant-variables" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> <code>select()</code> relevant variables</h1>
<p>Often our means of collecting data give us more information than we really care about. For example, Gorilla outputs all sorts of columns for screen size, browser etc. that won’t be helpful for our analysis. We likely want to create a refined version of the dataset that includes on the variables of interest.</p>
<p>To do this, we can use the <code>select()</code> function. Let’s say for example that we only need the variables <em>ID, item</em> and <em>acc</em>. We can do this as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select by name</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>select_dat1 <span class="ot">&lt;-</span> <span class="fu">select</span>(<span class="at">.data =</span> raw_dat, ID, item, acc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this code chunk, we create a new dataframe called <code>select_dat1</code>. The <code>select()</code> function takes the name of the dataframe you want to select from as the first argument (in this case, <code>raw_dat</code>). We then pass it the names of the variables we need. You should now see this dataframe in the environment pane - we still have all 6602 observations, but only the 3 variables we’ve specified. You can click the grid to see this for yourself.</p>
<p>If you have lots of variables that you want to keep, you might want a quicker way of selecting lots of variables at once. Try running these two alternatives:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select sequential columns by name</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>select_dat2 <span class="ot">&lt;-</span> <span class="fu">select</span>(<span class="at">.data =</span> raw_dat, ID, item<span class="sc">:</span>RT)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select columns by column number</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>select_dat3 <span class="ot">&lt;-</span> <span class="fu">select</span>(<span class="at">.data =</span> raw_dat, <span class="dv">1</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compare the new dataframes (<em>select_dat2</em>, <em>select_dat3</em>) to your original one. What is the <code>:</code> doing? How have the numbers worked to select columns in the second example?</p>
<p>Finally, it might sometimes be quicker just to specify the variables you <em>don’t</em> need. You can do this by using a <code>-</code> sign in front of the variable name. For example, the task column is redundant here as we only have data from one task, so we can remove it as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop columns </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>select_dat4 <span class="ot">&lt;-</span> <span class="fu">select</span>(<span class="at">.data =</span> raw_dat, <span class="sc">-</span>task)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ve seen here some different ways that you can tidy your dataset for relevant variables that you need. Importantly, we’ve still kept our <em>original</em> dataframe (<em>raw_dat</em>), so we can always edit and re-run this code if there’s something we’ve missed - be that by mistake as we go about writing our scripts, or further down the line when a reviewer asks for an obscure piece of information you didn’t think was relevant. Tidying our data in this way is fast and efficient, and avoids problems caused by trying to retrieve data and match it across raw and processed datasets.</p>
<p>Before we move on, let’s use your new column-selecting skills.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="EXERCISE 1">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
EXERCISE 1
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>EXERCISE 1:</strong> Create a new data frame called <code>selected_vars</code> which includes the following six variables: ID, learnTime, time, item, acc, RT</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show solution</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>selected_vars <span class="ot">&lt;-</span> <span class="fu">select</span>(<span class="at">.data =</span> raw_dat, ID, learnTime, time, item, acc, RT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="rename-variables" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> <code>rename() variables</code></h1>
<p>Once your dataset is a more manageable size, you might find that you want to rename your key variables. For example, in our current dataset, the difference between “learnTime” and “time” is not intuitive. Let’s rename these variables to make the difference clearer (and thereby reduce the risk of making mistakes in our code!).</p>
<p>You can do this using the <code>rename()</code> function, following the format <code>new_name = old_name</code>. Let’s do this with our raw dataset, renaming just the learnTime and time columns to better distinguish them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rename_dat1 <span class="ot">&lt;-</span> <span class="fu">rename</span>(<span class="at">.data =</span> raw_dat, <span class="at">encode_time =</span> learnTime, <span class="at">test_time =</span> time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As with the other <em>tidyverse</em> functions, the name of the dataset is needed as the first argument, then we simply list the new variable names that we want assigned to our old variable names. If you inspect the new dataframe (<code>rename_dat1</code>), you should be able to see that the two variables now have different names to before.</p>
<p>There are a few rules for creating column names! The main one is that names cannot include spaces. They can include letters (case sensitive), basic punctuation (dashes, underscores, points), and numbers as long as they are not at the start of the name. It’s a good idea to adopt a consistent style for tidiness and your own memory.</p>
<div class="callout callout-style-default callout-warning callout-titled" title="Poorly formatted column names">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Poorly formatted column names
</div>
</div>
<div class="callout-body-container callout-body">
<p>If your loaded data file *does* include spaces in column names, you will need to surround them in back-ticks to use them until you rename them.</p>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/common_cases.png" class="img-fluid figure-img" alt="Cartoon representations of common cases in coding. A snake screams &quot;SCREAMING_SNAKE_CASE&quot; into the face of a camel (wearing ear muffs) with &quot;camelCase&quot; written along its back. Vegetables on a skewer spell out &quot;kebab-case&quot; (words on a skewer). A mellow, happy looking snake has text &quot;snake_case&quot; along it." width="725"></p>
<figcaption><a href="https://x.com/allison_horst">Artwork by @allison_horst</a></figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="EXERCISE 2">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
EXERCISE 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a new dataframe called renamed_vars, by renaming your selected_vars dataframe from Exercise 1. Edit the column names for the following variables:</p>
<ul>
<li>ID &gt;&gt; ppt_ID</li>
<li>learnTime &gt;&gt; learn_time</li>
<li>time &gt;&gt; test_time</li>
</ul>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show solution</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>renamed_vars <span class="ot">&lt;-</span> selected_vars <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ppt_ID =</span> ID, <span class="at">learn_time =</span> learnTime, <span class="at">test_time =</span> time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filter-for-relevant-data" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> <code>filter()</code> for relevant data</h1>
<p>Another typical step in data processing is to filter for the data we are interested in. For example, this dataset collected responses across four test sessions, but suppose we only want to analyse data from session one. We can create a reduced version of dataset for this purpose using the <code>filter()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>filter_dat <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, time <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just as with the earlier functions, the first argument is the name of the dataframe that we want to filter (<code>raw_dat</code>). We then specify the conditions for retaining data: here that we want the <code>session</code> variable to be equal to (<code>==</code>) the value of 1. You can see in the environment menu that this <code>filter_dat</code> dataframe should have appeared. We’ve kept all 9 variables as we haven’t instructed otherwise, but we have approximately quarter of the number of observations now. If you inspect this dataframe by clicking the grid icon, you should see that we have dropped all of the trials from sessions 2-4.</p>
<p>We can use different <a href="https://bookdown.org/rwnahhas/IntroToR/logical.html">logical operators</a> to specify conditions in different ways.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/filter.png" class="img-fluid figure-img" alt="Cartoon showing three fuzzy monsters either selecting or crossing out rows of a data table. If the type of animal in the table is “otter” and the site is “bay”, a monster is drawing a purple rectangle around the row. If those conditions are not met, another monster is putting a line through the column indicating it will be excluded. Stylized text reads “dplyr::filter() - keep rows that satisfy your conditions.”" width="904"></p>
<figcaption><a href="https://x.com/allison_horst">Artwork by @allison_horst</a></figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="EXERCISE 3">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
EXERCISE 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>What do you think the following lines of code might do to the data? Then try running them to see if your predictions are correct.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 1</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>filter_dat1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, RT <span class="sc">&gt;</span> <span class="dv">500</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 2</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>filter_dat2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, RT <span class="sc">&lt;=</span> <span class="dv">2000</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 3</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>filter_dat3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, <span class="sc">!</span><span class="fu">is.na</span>(RT))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 4</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>filter_dat4 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, item <span class="sc">==</span> <span class="st">"agouti"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 5 </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>filter_dat5 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, time <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> RT <span class="sc">&lt;=</span> <span class="dv">2000</span> )</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 6</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>filter_dat6 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, item <span class="sc">==</span> <span class="st">"banyan"</span> <span class="sc">|</span> item <span class="sc">==</span> <span class="st">"caracal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show solution</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 1 - includes only responses slower than 500 ms (excludes fast responses)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>filter_dat1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, RT <span class="sc">&gt;</span> <span class="dv">500</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 2 - includes only responses less than or equal to 2000 ms (excludes slow)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>filter_dat2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, RT <span class="sc">&lt;=</span> <span class="dv">2000</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 3 - excludes observations where RT is missing data</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>filter_dat3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, <span class="sc">!</span><span class="fu">is.na</span>(RT))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 4 - keep only responses to "agouti" item</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>filter_dat4 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, item <span class="sc">==</span> <span class="st">"agouti"</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 5  - keep responses from time 1 that are less than or equal to 2000 ms (excludes slow)</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>filter_dat5 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, time <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> RT <span class="sc">&lt;=</span> <span class="dv">2000</span> )</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 6 - keep only responses to "banyan" or "caracal" items</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>filter_dat6 <span class="ot">&lt;-</span> <span class="fu">filter</span>(raw_dat, item <span class="sc">==</span> <span class="st">"banyan"</span> <span class="sc">|</span> item <span class="sc">==</span> <span class="st">"caracal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>You can specify and combine your selection criteria in pretty much any way imaginable. Again, the key benefit here is that we haven’t lost our original data at any point. Realise you’ve done something wrong? Edit and run it again. Need versions of your dataset with and without certain participants included? Create two versions. Reviewers query the impact of your exclusion criteria? Show them a version without. These data came from the same stored dataset (no deleting data you might regret!), and you’ve documented in code exactly what you’ve done with them. Having these steps scripted is a major win for reproducibility.</p>
</section>
<section id="combining-data-cleaning-steps-using-the-pipe-operator" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Combining data cleaning steps using the pipe <code>|&gt;</code> operator</h1>
<p>So far, we’ve selected, renamed, and filtered our data in separate steps, reassigning the result to a new dataframe each time. This is fine, and very helpful when you are first developing your code as it allows you to inspect/test each step as you go and check things are running as expected.</p>
<p>However, in the long run, this can get a bit messy as we end up with lots of different dataframes in the environment. It also becomes increasingly difficult to name them all something sensible, and it’s easy to lose track and make mistakes of which dataframe we are suppose to be using.</p>
<p>To counter this problem, the <em>tidyverse</em> has a handy function called the <em>pipe</em> operator. It looks like this: <code>|&gt;</code> , or alternatively like this <code>%&gt;%</code> (older version). You can read the pipe operator as “<em>and then</em>”. It takes the output from the code to the left of it, <em>and then</em> sends it to the first argument of your next line of code. Remember that the first argument of the <code>select()</code>, <code>rename()</code>, and <code>filter()</code> functions was the data, so this works very nicely.</p>
<p>For example, we can select our variables of interest then filter for the observations we want, all in a single step as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>select_filter_dat <span class="ot">&lt;-</span> raw_dat <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, time, item, RT) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">test_time =</span> time) <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(RT <span class="sc">&lt;</span> <span class="dv">3000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So you can read the above chunk as follows: create a new dataframe called <code>select_filter_dat</code> by taking the <code>raw_dat</code> dataframe <strong>AND THEN</strong> selecting relevant variables (ID, test, item, RT) <strong>AND THEN</strong> renaming test to test_time <strong>AND THEN</strong> filtering for only those trials where the RT was less than 3000 ms. We haven’t needed to rename the dataframe at each stage, as the pipe has filled this in for us from the previous set.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>